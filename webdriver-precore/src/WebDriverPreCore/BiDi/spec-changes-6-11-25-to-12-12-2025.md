# WebDriver BiDi Spec Changes (Nov 6, 2025 → Dec 12, 2025)

## Summary
This document tracks changes between W3C Working Draft from November 6, 2025 and December 12, 2025.

---

## 1. Session Module Type Rename

**Description**: Renamed `session.SubscriptionRequest` to `session.SubscribeParameters` and clarified its purpose to only handle subscription requests (not unsubscription).

**CDDL**:
```cddl
session.SubscribeParameters = {
  events: [+text],
  ? contexts: [+browsingContext.BrowsingContext],
  ? userContexts: [+browser.UserContext],
}
```

**Impact**: Type name change affects the `session.subscribe` command parameters.

---

## 2. New Screen Settings Infrastructure

**Description**: Added screen settings data structures to support emulating screen dimensions.

**CDDL**:
```cddl
; A screen settings struct with dimensions
screen_settings = {
  height: integer,
  width: integer,
  x: integer,
  y: integer
}

; Remote end maintains screen settings overrides
screen_settings_overrides = {
  user_context_screen_settings: weak_map,  ; user contexts → screen settings
  navigable_screen_settings: weak_map      ; navigables → screen settings
}
```

**Impact**: Foundation for new `emulation.setScreenSettingsOverride` command.

---

## 3. New Command: `emulation.setScreenSettingsOverride`

**Description**: New command to emulate web-exposed screen area and available screen area for top-level traversables or user contexts. This is now command 7.4.2.5, with subsequent emulation commands renumbered.

**CDDL**:
```cddl
emulation.SetScreenSettingsOverride = (
  method: "emulation.setScreenSettingsOverride",
  params: emulation.SetScreenSettingsOverrideParameters
)

emulation.ScreenArea = {
  width: js-uint,
  height: js-uint
}

emulation.SetScreenSettingsOverrideParameters = {
  screenArea: emulation.ScreenArea / null,
  ? contexts: [+browsingContext.BrowsingContext],
  ? userContexts: [+browser.UserContext],
}

emulation.SetScreenSettingsOverrideResult = EmptyResult
```

**Impact**: Enables precise control over emulated screen dimensions per context.

---

## 4. Emulation Command Renumbering

**Description**: Due to insertion of `emulation.setScreenSettingsOverride`, all subsequent emulation commands were renumbered:

- `emulation.setScreenOrientationOverride`: 7.4.2.5 → **7.4.2.6**
- `emulation.setUserAgentOverride`: 7.4.2.6 → **7.4.2.7**
- `emulation.setScriptingEnabled`: 7.4.2.7 → **7.4.2.8**
- `emulation.setTimezoneOverride`: 7.4.2.8 → **7.4.2.9**

**Impact**: Documentation references and section numbers updated throughout spec.

---

## 5. Network Command Return Type Clarification

**Description**: Changed `emulation.setNetworkConditions` from implicit `EmptyResult` to explicit named return type.

**CDDL**:
```cddl
; Before:
; Result Type
;     EmptyResult

; After:
Return Type
    emulation.SetNetworkConditionsResult = EmptyResult
```

**Impact**: Improved consistency with other command definitions.

---

## 6. CDDL Whitespace Formatting Changes

**Description**: Added blank lines to improve readability in several CDDL definitions:

### 6a. `network.Cookie` Definition
```cddl
network.SameSite = "strict" / "lax" / "none" / "default"

                    ; <-- blank line added
network.Cookie = {
    name: text,
    value: network.BytesValue,
    ...
}
```

### 6b. `network.FetchTimingInfo` Definition
```cddl
network.FetchTimingInfo = {
    ...
    tlsStart: float,
                    ; <-- blank line added
    requestStart: float,
    responseStart: float,
                    ; <-- blank line added
    responseEnd: float,
}
```

### 6c. `script.SharedReference` Definition
```cddl
script.SharedReference = {
   sharedId: script.SharedId
                    ; <-- blank line added
   ? handle: script.Handle,
   Extensible
}
```

### 6d. `script.RemoteObjectReference` Definition
```cddl
script.RemoteObjectReference = {
   handle: script.Handle,
                    ; <-- blank line added
   ? sharedId: script.SharedId
   Extensible
}
```

### 6e. `storage.GetCookies` Command
```cddl
storage.GetCookies = (
  method: "storage.getCookies",
  params: storage.GetCookiesParameters
)
                    ; <-- blank line added

storage.CookieFilter = {
  ...
}
```

### 6f. `storage.SetCookie` Command
```cddl
storage.SetCookie = (
  method: "storage.setCookie",
  params: storage.SetCookieParameters,
)
                    ; <-- blank line added

storage.PartialCookie = {
  ...
}
```

**Impact**: No semantic changes, improved visual organization of CDDL definitions.

---

## 7. Capability Table Formatting

**Description**: Minor formatting improvement to WebSocket URL capability table alignment.

**Before**:
```
Capability     WebSocket URL
Key    "webSocketUrl"
Value type     boolean
Description    Defines the current session's support for bidirectional connection.
```

**After**:
```
Capability:    WebSocket URL
Key:   "webSocketUrl"
Value type:    boolean
Description:   Defines the current session's support for bidirectional connection.
```

**Impact**: Cosmetic only, improved table consistency.

---

## Action Items

1. **Implement** `emulation.setScreenSettingsOverride` command with new screen area types
2. **Update** session subscribe implementation to use `session.SubscribeParameters` type name
3. **Add** screen settings infrastructure (weak maps for navigables and user contexts)
4. **Verify** all emulation command section references reflect new numbering (7.4.2.5-7.4.2.9)
5. **Update** `emulation.setNetworkConditions` return type to named `emulation.SetNetworkConditionsResult`
6. **Apply** CDDL formatting improvements (optional, whitespace only)

---

## Statistics

- **Total diff lines**: 926
- **Breaking changes**: 1 (type rename from `SubscriptionRequest` to `SubscribeParameters`)
- **New commands**: 1 (`emulation.setScreenSettingsOverride`)
- **New types**: 3 (`ScreenArea`, `SetScreenSettingsOverrideParameters`, `SetScreenSettingsOverrideResult`)
- **Renumbered sections**: 4 (emulation commands 7.4.2.6-7.4.2.9)
